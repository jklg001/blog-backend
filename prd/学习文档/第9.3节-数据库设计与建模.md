# ç¬¬9.3èŠ‚ æ•°æ®åº“è®¾è®¡ä¸å»ºæ¨¡

> **æ•°æ®é©±åŠ¨è®¾è®¡** - MySQLæ•°æ®åº“çš„ä¸“ä¸šè®¾è®¡ä¸å»ºæ¨¡å®è·µ

## ğŸ“š æœ¬èŠ‚å­¦ä¹ ç›®æ ‡

### ğŸ¯ çŸ¥è¯†ç›®æ ‡
- [ ] **æŒæ¡æ•°æ®åº“è®¾è®¡åŸåˆ™**ï¼šå­¦ä¼šä¼ä¸šçº§æ•°æ®åº“çš„è®¾è®¡æ–¹æ³•å’Œè§„èŒƒ
- [ ] **ç†è§£å®ä½“å…³ç³»å»ºæ¨¡**ï¼šæŒæ¡ERå›¾è®¾è®¡å’Œå…³ç³»æ¨¡å‹è½¬æ¢
- [ ] **å­¦ä¼šMySQLä¼˜åŒ–æŠ€å·§**ï¼šæŒæ¡ç´¢å¼•è®¾è®¡å’ŒæŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥
- [ ] **æŒæ¡æ•°æ®è¿ç§»æ–¹æ¡ˆ**ï¼šå­¦ä¼šæ•°æ®åº“ç‰ˆæœ¬ç®¡ç†å’Œè¿ç§»ç­–ç•¥

### ğŸ› ï¸ æŠ€èƒ½ç›®æ ‡
- [ ] èƒ½å¤Ÿè®¾è®¡å®Œæ•´çš„æ•°æ®åº“è¡¨ç»“æ„
- [ ] èƒ½å¤Ÿç»˜åˆ¶æ ‡å‡†çš„ERå›¾
- [ ] èƒ½å¤Ÿç¼–å†™é«˜æ•ˆçš„SQLæŸ¥è¯¢
- [ ] èƒ½å¤Ÿåˆ¶å®šæ•°æ®åº“è¿ç§»æ–¹æ¡ˆ

### â° å­¦ä¹ æ—¶é•¿
- **ç†è®ºå­¦ä¹ **ï¼š3-4å°æ—¶
- **å®è·µç»ƒä¹ **ï¼š3-4å°æ—¶
- **æ€»è®¡æ—¶é•¿**ï¼š6-8å°æ—¶

### ğŸ“‹ å‰ç½®çŸ¥è¯†æ£€æŸ¥
- [ ] æŒæ¡MySQLåŸºç¡€è¯­æ³•
- [ ] ç†è§£å…³ç³»æ•°æ®åº“ç†è®º
- [ ] äº†è§£æ•°æ®åº“èŒƒå¼
- [ ] ç†Ÿæ‚‰TypeORMåŸºæœ¬ä½¿ç”¨

---

## 9.3.1 æ•°æ®åº“è®¾è®¡åŸåˆ™ä¸è§„èŒƒ

### ğŸ“Š æ•°æ®åº“è®¾è®¡åŸºç¡€

#### ğŸ’¡ ä»€ä¹ˆæ˜¯æ•°æ®åº“è®¾è®¡ï¼Ÿ

**æ•°æ®åº“è®¾è®¡å°±åƒå»ºç­‘è“å›¾è®¾è®¡**ï¼š
- ğŸ—ï¸ **å»ºç­‘å¸ˆ**è®¾è®¡æˆ¿å±‹ç»“æ„ â†’ **æ•°æ®åº“è®¾è®¡å¸ˆ**è®¾è®¡æ•°æ®ç»“æ„
- ğŸ“ **æˆ¿é—´å¸ƒå±€è§„åˆ’** â†’ **è¡¨ç»“æ„è®¾è®¡**
- ğŸšª **æˆ¿é—´è¿æ¥é€šé“** â†’ **è¡¨å…³ç³»è®¾è®¡**
- ğŸ”§ **æ°´ç”µç®¡é“å¸ƒå±€** â†’ **ç´¢å¼•å’Œçº¦æŸè®¾è®¡**

#### ğŸ¯ è®¾è®¡åŸåˆ™

**1. æ•°æ®å®Œæ•´æ€§åŸåˆ™**
- **å®ä½“å®Œæ•´æ€§**ï¼šæ¯ä¸ªè¡¨éƒ½æœ‰ä¸»é”®
- **å‚ç…§å®Œæ•´æ€§**ï¼šå¤–é”®å…³ç³»æ­£ç¡®
- **åŸŸå®Œæ•´æ€§**ï¼šå­—æ®µå€¼ç¬¦åˆçº¦æŸ
- **ç”¨æˆ·å®šä¹‰å®Œæ•´æ€§**ï¼šä¸šåŠ¡è§„åˆ™çº¦æŸ

**2. æ•°æ®ä¸€è‡´æ€§åŸåˆ™**
- **ACIDç‰¹æ€§**ï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§
- **äº‹åŠ¡ç®¡ç†**ï¼šç¡®ä¿æ•°æ®æ“ä½œçš„å®Œæ•´æ€§
- **å¹¶å‘æ§åˆ¶**ï¼šé¿å…æ•°æ®å†²çª

**3. æ€§èƒ½ä¼˜åŒ–åŸåˆ™**
- **æŸ¥è¯¢æ•ˆç‡**ï¼šåˆç†è®¾è®¡ç´¢å¼•
- **å­˜å‚¨æ•ˆç‡**ï¼šé€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹
- **ç»´æŠ¤æ•ˆç‡**ï¼šé¿å…è¿‡åº¦è§„èŒƒåŒ–

**4. å¯æ‰©å±•æ€§åŸåˆ™**
- **æ°´å¹³æ‰©å±•**ï¼šæ”¯æŒåˆ†åº“åˆ†è¡¨
- **å‚ç›´æ‰©å±•**ï¼šæ”¯æŒå­—æ®µæ‰©å±•
- **ç‰ˆæœ¬å…¼å®¹**ï¼šæ”¯æŒç»“æ„å‡çº§

### ğŸ“‹ å‘½åè§„èŒƒ

#### ğŸ·ï¸ è¡¨å‘½åè§„èŒƒ

**åŸºæœ¬è§„åˆ™**ï¼š
- ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
- ä½¿ç”¨å¤æ•°å½¢å¼è¡¨ç¤ºé›†åˆ
- é¿å…ä½¿ç”¨MySQLä¿ç•™å­—
- åç§°è¦æœ‰æ„ä¹‰ä¸”ç®€æ´

**ç¤ºä¾‹**ï¼š
```sql
-- âœ… å¥½çš„å‘½å
users              -- ç”¨æˆ·è¡¨
user_profiles      -- ç”¨æˆ·èµ„æ–™è¡¨
articles           -- æ–‡ç« è¡¨
article_tags       -- æ–‡ç« æ ‡ç­¾å…³è”è¡¨

-- âŒ ä¸å¥½çš„å‘½å
User               -- å¤§å†™å­—æ¯
user               -- å•æ•°å½¢å¼
t_user             -- æ— æ„ä¹‰å‰ç¼€
user_info_detail   -- è¿‡äºå†—é•¿
```

#### ğŸ·ï¸ å­—æ®µå‘½åè§„èŒƒ

**åŸºæœ¬è§„åˆ™**ï¼š
- ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
- ä¸»é”®ç»Ÿä¸€ä½¿ç”¨`id`
- å¤–é”®ä½¿ç”¨`è¡¨å_id`æ ¼å¼
- æ—¶é—´å­—æ®µä½¿ç”¨`_at`åç¼€
- å¸ƒå°”å­—æ®µä½¿ç”¨`is_`å‰ç¼€

**ç¤ºä¾‹**ï¼š
```sql
-- âœ… å¥½çš„å‘½å
id                 -- ä¸»é”®
user_id            -- å¤–é”®
username           -- ç”¨æˆ·å
email_verified     -- å¸ƒå°”å­—æ®µ
created_at         -- åˆ›å»ºæ—¶é—´
updated_at         -- æ›´æ–°æ—¶é—´

-- âŒ ä¸å¥½çš„å‘½å
ID                 -- å¤§å†™
userId             -- é©¼å³°å‘½å
user_name          -- ä¸å¿…è¦çš„ä¸‹åˆ’çº¿
is_email_verified  -- è¿‡äºå†—é•¿
create_time        -- ä¸ç»Ÿä¸€çš„åç¼€
```

### ğŸ”¢ æ•°æ®ç±»å‹é€‰æ‹©

#### ğŸ“Š å¸¸ç”¨æ•°æ®ç±»å‹

**å­—ç¬¦ä¸²ç±»å‹**ï¼š
```sql
-- å›ºå®šé•¿åº¦å­—ç¬¦ä¸²ï¼ˆæ€§èƒ½å¥½ï¼Œä½†æµªè´¹ç©ºé—´ï¼‰
CHAR(36)           -- UUID
CHAR(2)            -- å›½å®¶ä»£ç 

-- å¯å˜é•¿åº¦å­—ç¬¦ä¸²ï¼ˆèŠ‚çœç©ºé—´ï¼‰
VARCHAR(50)        -- ç”¨æˆ·å
VARCHAR(255)       -- é‚®ç®±åœ°å€
VARCHAR(500)       -- URLåœ°å€

-- å¤§æ–‡æœ¬ç±»å‹
TEXT               -- æ–‡ç« æ‘˜è¦ï¼ˆ< 65KBï¼‰
LONGTEXT           -- æ–‡ç« å†…å®¹ï¼ˆ< 4GBï¼‰
```

**æ•°å€¼ç±»å‹**ï¼š
```sql
-- æ•´æ•°ç±»å‹
TINYINT            -- çŠ¶æ€å€¼ï¼ˆ-128 åˆ° 127ï¼‰
INT                -- è®¡æ•°å™¨ï¼ˆ-2^31 åˆ° 2^31-1ï¼‰
BIGINT             -- å¤§æ•°å€¼ï¼ˆ-2^63 åˆ° 2^63-1ï¼‰

-- æ— ç¬¦å·æ•´æ•°ï¼ˆæ¨èç”¨äºè®¡æ•°ï¼‰
INT UNSIGNED       -- é˜…è¯»é‡ã€ç‚¹èµæ•°
BIGINT UNSIGNED    -- å¤§è®¡æ•°å™¨

-- å°æ•°ç±»å‹
DECIMAL(10,2)      -- é‡‘é¢ï¼ˆç²¾ç¡®ï¼‰
FLOAT              -- è¯„åˆ†ï¼ˆè¿‘ä¼¼ï¼‰
```

**æ—¶é—´ç±»å‹**ï¼š
```sql
-- æ¨èä½¿ç”¨TIMESTAMPï¼ˆè‡ªåŠ¨æ—¶åŒºè½¬æ¢ï¼‰
TIMESTAMP DEFAULT CURRENT_TIMESTAMP
TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP

-- æ—¥æœŸç±»å‹
DATE               -- ç”Ÿæ—¥
DATETIME           -- å…·ä½“æ—¶é—´ç‚¹
```

**æšä¸¾ç±»å‹**ï¼š
```sql
-- çŠ¶æ€æšä¸¾
ENUM('active', 'inactive', 'banned')
ENUM('draft', 'published', 'archived')
ENUM('pending', 'approved', 'rejected')
```

---

## 9.3.2 å®ä½“å…³ç³»å»ºæ¨¡

### ğŸ“Š ERå›¾è®¾è®¡

#### ğŸ¯ æ ¸å¿ƒå®ä½“è¯†åˆ«

**åšå®¢ç³»ç»Ÿæ ¸å¿ƒå®ä½“**ï¼š

**ç”¨æˆ·å®ä½“ï¼ˆUserï¼‰**
- **å±æ€§**ï¼šç”¨æˆ·IDã€ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç ã€çŠ¶æ€
- **å…³ç³»**ï¼šä¸€ä¸ªç”¨æˆ·å¯ä»¥å†™å¤šç¯‡æ–‡ç« ã€å‘å¤šæ¡è¯„è®º

**æ–‡ç« å®ä½“ï¼ˆArticleï¼‰**
- **å±æ€§**ï¼šæ–‡ç« IDã€æ ‡é¢˜ã€å†…å®¹ã€çŠ¶æ€ã€å‘å¸ƒæ—¶é—´
- **å…³ç³»**ï¼šå±äºä¸€ä¸ªç”¨æˆ·ã€å±äºä¸€ä¸ªåˆ†ç±»ã€æœ‰å¤šä¸ªæ ‡ç­¾

**åˆ†ç±»å®ä½“ï¼ˆCategoryï¼‰**
- **å±æ€§**ï¼šåˆ†ç±»IDã€åˆ†ç±»åã€æè¿°ã€çˆ¶åˆ†ç±»
- **å…³ç³»**ï¼šåŒ…å«å¤šç¯‡æ–‡ç« ã€å¯ä»¥æœ‰å­åˆ†ç±»

**æ ‡ç­¾å®ä½“ï¼ˆTagï¼‰**
- **å±æ€§**ï¼šæ ‡ç­¾IDã€æ ‡ç­¾åã€æè¿°ã€ä½¿ç”¨æ¬¡æ•°
- **å…³ç³»**ï¼šå¯ä»¥æ ‡è®°å¤šç¯‡æ–‡ç« 

**è¯„è®ºå®ä½“ï¼ˆCommentï¼‰**
- **å±æ€§**ï¼šè¯„è®ºIDã€å†…å®¹ã€çŠ¶æ€ã€å‘å¸ƒæ—¶é—´
- **å…³ç³»**ï¼šå±äºä¸€ç¯‡æ–‡ç« ã€å±äºä¸€ä¸ªç”¨æˆ·ã€å¯ä»¥å›å¤å…¶ä»–è¯„è®º

#### ğŸ”— å…³ç³»ç±»å‹è®¾è®¡

**ä¸€å¯¹ä¸€å…³ç³»ï¼ˆ1:1ï¼‰**
```
ç”¨æˆ· â†â†’ ç”¨æˆ·èµ„æ–™
ä¸€ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªè¯¦ç»†èµ„æ–™
```

**ä¸€å¯¹å¤šå…³ç³»ï¼ˆ1:Nï¼‰**
```
ç”¨æˆ· â†â†’ æ–‡ç« 
ä¸€ä¸ªç”¨æˆ·å¯ä»¥å†™å¤šç¯‡æ–‡ç« 

æ–‡ç«  â†â†’ è¯„è®º
ä¸€ç¯‡æ–‡ç« å¯ä»¥æœ‰å¤šæ¡è¯„è®º

åˆ†ç±» â†â†’ æ–‡ç« 
ä¸€ä¸ªåˆ†ç±»å¯ä»¥åŒ…å«å¤šç¯‡æ–‡ç« 
```

**å¤šå¯¹å¤šå…³ç³»ï¼ˆM:Nï¼‰**
```
æ–‡ç«  â†â†’ æ ‡ç­¾
ä¸€ç¯‡æ–‡ç« å¯ä»¥æœ‰å¤šä¸ªæ ‡ç­¾ï¼Œä¸€ä¸ªæ ‡ç­¾å¯ä»¥æ ‡è®°å¤šç¯‡æ–‡ç« 

ç”¨æˆ· â†â†’ ç”¨æˆ·ï¼ˆå…³æ³¨å…³ç³»ï¼‰
ä¸€ä¸ªç”¨æˆ·å¯ä»¥å…³æ³¨å¤šä¸ªç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥è¢«å¤šä¸ªç”¨æˆ·å…³æ³¨
```

#### ğŸ“‹ ERå›¾ç»˜åˆ¶

```mermaid
erDiagram
    USERS {
        char(36) id PK
        varchar(50) username UK
        varchar(255) email UK
        varchar(255) password_hash
        enum status
        boolean email_verified
        timestamp created_at
        timestamp updated_at
    }
    
    USER_PROFILES {
        char(36) user_id PK,FK
        varchar(100) display_name
        text bio
        varchar(500) avatar_url
        varchar(255) website
        varchar(100) location
        date birth_date
        timestamp created_at
        timestamp updated_at
    }
    
    CATEGORIES {
        char(36) id PK
        varchar(100) name UK
        varchar(100) slug UK
        text description
        char(36) parent_id FK
        int sort_order
        boolean is_active
        timestamp created_at
    }
    
    ARTICLES {
        char(36) id PK
        varchar(255) title
        varchar(255) slug UK
        text summary
        longtext content
        char(36) author_id FK
        char(36) category_id FK
        enum status
        varchar(500) featured_image
        int view_count
        int like_count
        int comment_count
        timestamp published_at
        timestamp created_at
        timestamp updated_at
    }
    
    TAGS {
        char(36) id PK
        varchar(50) name UK
        varchar(50) slug UK
        text description
        varchar(7) color
        int usage_count
        timestamp created_at
    }
    
    ARTICLE_TAGS {
        char(36) article_id PK,FK
        char(36) tag_id PK,FK
        timestamp created_at
    }
    
    COMMENTS {
        char(36) id PK
        char(36) article_id FK
        char(36) author_id FK
        char(36) parent_id FK
        text content
        enum status
        int like_count
        timestamp created_at
        timestamp updated_at
    }
    
    USERS ||--|| USER_PROFILES : has
    USERS ||--o{ ARTICLES : writes
    USERS ||--o{ COMMENTS : posts
    CATEGORIES ||--o{ ARTICLES : contains
    CATEGORIES ||--o{ CATEGORIES : parent_of
    ARTICLES ||--o{ COMMENTS : has
    ARTICLES }o--o{ TAGS : tagged_with
    COMMENTS ||--o{ COMMENTS : replies_to
```

### ğŸ—„ï¸ å®Œæ•´è¡¨ç»“æ„è®¾è®¡

#### ğŸ‘¥ ç”¨æˆ·ç›¸å…³è¡¨

**usersè¡¨ï¼ˆç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼‰**
```sql
CREATE TABLE users (
    id CHAR(36) PRIMARY KEY COMMENT 'ç”¨æˆ·IDï¼ˆUUIDï¼‰',
    username VARCHAR(50) UNIQUE NOT NULL COMMENT 'ç”¨æˆ·å',
    email VARCHAR(255) UNIQUE NOT NULL COMMENT 'é‚®ç®±åœ°å€',
    password_hash VARCHAR(255) NOT NULL COMMENT 'å¯†ç å“ˆå¸Œ',
    status ENUM('active', 'inactive', 'banned') DEFAULT 'active' COMMENT 'ç”¨æˆ·çŠ¶æ€',
    email_verified BOOLEAN DEFAULT FALSE COMMENT 'é‚®ç®±æ˜¯å¦éªŒè¯',
    last_login_at TIMESTAMP NULL COMMENT 'æœ€åç™»å½•æ—¶é—´',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    
    INDEX idx_email (email),
    INDEX idx_username (username),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·åŸºæœ¬ä¿¡æ¯è¡¨';
```

**user_profilesè¡¨ï¼ˆç”¨æˆ·è¯¦ç»†èµ„æ–™ï¼‰**
```sql
CREATE TABLE user_profiles (
    user_id CHAR(36) PRIMARY KEY COMMENT 'ç”¨æˆ·ID',
    display_name VARCHAR(100) COMMENT 'æ˜¾ç¤ºåç§°',
    bio TEXT COMMENT 'ä¸ªäººç®€ä»‹',
    avatar_url VARCHAR(500) COMMENT 'å¤´åƒURL',
    website VARCHAR(255) COMMENT 'ä¸ªäººç½‘ç«™',
    location VARCHAR(100) COMMENT 'æ‰€åœ¨åœ°',
    birth_date DATE COMMENT 'ç”Ÿæ—¥',
    gender ENUM('male', 'female', 'other') COMMENT 'æ€§åˆ«',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·è¯¦ç»†èµ„æ–™è¡¨';
```

**rolesè¡¨ï¼ˆè§’è‰²è¡¨ï¼‰**
```sql
CREATE TABLE roles (
    id CHAR(36) PRIMARY KEY COMMENT 'è§’è‰²ID',
    name VARCHAR(50) UNIQUE NOT NULL COMMENT 'è§’è‰²åç§°',
    description TEXT COMMENT 'è§’è‰²æè¿°',
    permissions JSON COMMENT 'æƒé™åˆ—è¡¨',
    is_active BOOLEAN DEFAULT TRUE COMMENT 'æ˜¯å¦æ¿€æ´»',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    
    INDEX idx_name (name),
    INDEX idx_is_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è§’è‰²è¡¨';
```

**user_rolesè¡¨ï¼ˆç”¨æˆ·è§’è‰²å…³è”è¡¨ï¼‰**
```sql
CREATE TABLE user_roles (
    user_id CHAR(36) NOT NULL COMMENT 'ç”¨æˆ·ID',
    role_id CHAR(36) NOT NULL COMMENT 'è§’è‰²ID',
    assigned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ†é…æ—¶é—´',
    assigned_by CHAR(36) COMMENT 'åˆ†é…è€…ID',
    
    PRIMARY KEY (user_id, role_id),
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,
    FOREIGN KEY (assigned_by) REFERENCES users(id),
    INDEX idx_user_id (user_id),
    INDEX idx_role_id (role_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·è§’è‰²å…³è”è¡¨';
```

#### ğŸ“ å†…å®¹ç›¸å…³è¡¨

**categoriesè¡¨ï¼ˆæ–‡ç« åˆ†ç±»ï¼‰**
```sql
CREATE TABLE categories (
    id CHAR(36) PRIMARY KEY COMMENT 'åˆ†ç±»ID',
    name VARCHAR(100) UNIQUE NOT NULL COMMENT 'åˆ†ç±»åç§°',
    slug VARCHAR(100) UNIQUE NOT NULL COMMENT 'URLåˆ«å',
    description TEXT COMMENT 'åˆ†ç±»æè¿°',
    parent_id CHAR(36) COMMENT 'çˆ¶åˆ†ç±»ID',
    sort_order INT DEFAULT 0 COMMENT 'æ’åºæƒé‡',
    is_active BOOLEAN DEFAULT TRUE COMMENT 'æ˜¯å¦æ¿€æ´»',
    article_count INT UNSIGNED DEFAULT 0 COMMENT 'æ–‡ç« æ•°é‡',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    
    FOREIGN KEY (parent_id) REFERENCES categories(id) ON DELETE SET NULL,
    INDEX idx_slug (slug),
    INDEX idx_parent_id (parent_id),
    INDEX idx_sort_order (sort_order),
    INDEX idx_is_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ–‡ç« åˆ†ç±»è¡¨';
```

**tagsè¡¨ï¼ˆæ ‡ç­¾è¡¨ï¼‰**
```sql
CREATE TABLE tags (
    id CHAR(36) PRIMARY KEY COMMENT 'æ ‡ç­¾ID',
    name VARCHAR(50) UNIQUE NOT NULL COMMENT 'æ ‡ç­¾åç§°',
    slug VARCHAR(50) UNIQUE NOT NULL COMMENT 'URLåˆ«å',
    description TEXT COMMENT 'æ ‡ç­¾æè¿°',
    color VARCHAR(7) DEFAULT '#007bff' COMMENT 'æ ‡ç­¾é¢œè‰²ï¼ˆHEXï¼‰',
    usage_count INT UNSIGNED DEFAULT 0 COMMENT 'ä½¿ç”¨æ¬¡æ•°',
    is_active BOOLEAN DEFAULT TRUE COMMENT 'æ˜¯å¦æ¿€æ´»',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    
    INDEX idx_slug (slug),
    INDEX idx_usage_count (usage_count DESC),
    INDEX idx_is_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ ‡ç­¾è¡¨';
```

**articlesè¡¨ï¼ˆæ–‡ç« ä¸»è¡¨ï¼‰**
```sql
CREATE TABLE articles (
    id CHAR(36) PRIMARY KEY COMMENT 'æ–‡ç« ID',
    title VARCHAR(255) NOT NULL COMMENT 'æ–‡ç« æ ‡é¢˜',
    slug VARCHAR(255) UNIQUE NOT NULL COMMENT 'URLåˆ«å',
    summary TEXT COMMENT 'æ–‡ç« æ‘˜è¦',
    content LONGTEXT NOT NULL COMMENT 'æ–‡ç« å†…å®¹',
    content_type ENUM('markdown', 'html', 'rich_text') DEFAULT 'markdown' COMMENT 'å†…å®¹ç±»å‹',
    author_id CHAR(36) NOT NULL COMMENT 'ä½œè€…ID',
    category_id CHAR(36) COMMENT 'åˆ†ç±»ID',
    status ENUM('draft', 'published', 'archived', 'deleted') DEFAULT 'draft' COMMENT 'æ–‡ç« çŠ¶æ€',
    featured_image VARCHAR(500) COMMENT 'ç‰¹è‰²å›¾ç‰‡URL',
    reading_time INT UNSIGNED COMMENT 'é¢„è®¡é˜…è¯»æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰',
    view_count INT UNSIGNED DEFAULT 0 COMMENT 'æµè§ˆæ¬¡æ•°',
    like_count INT UNSIGNED DEFAULT 0 COMMENT 'ç‚¹èµæ¬¡æ•°',
    comment_count INT UNSIGNED DEFAULT 0 COMMENT 'è¯„è®ºæ¬¡æ•°',
    is_featured BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦æ¨è',
    allow_comments BOOLEAN DEFAULT TRUE COMMENT 'æ˜¯å¦å…è®¸è¯„è®º',
    published_at TIMESTAMP NULL COMMENT 'å‘å¸ƒæ—¶é—´',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    
    FOREIGN KEY (author_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL,
    INDEX idx_slug (slug),
    INDEX idx_author_id (author_id),
    INDEX idx_category_id (category_id),
    INDEX idx_status (status),
    INDEX idx_published_at (published_at DESC),
    INDEX idx_view_count (view_count DESC),
    INDEX idx_like_count (like_count DESC),
    INDEX idx_is_featured (is_featured),
    INDEX idx_author_status_published (author_id, status, published_at DESC),
    INDEX idx_category_status_published (category_id, status, published_at DESC),
    FULLTEXT INDEX idx_content_search (title, content)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ–‡ç« ä¸»è¡¨';
```

**article_tagsè¡¨ï¼ˆæ–‡ç« æ ‡ç­¾å…³è”è¡¨ï¼‰**
```sql
CREATE TABLE article_tags (
    article_id CHAR(36) NOT NULL COMMENT 'æ–‡ç« ID',
    tag_id CHAR(36) NOT NULL COMMENT 'æ ‡ç­¾ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    
    PRIMARY KEY (article_id, tag_id),
    FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE,
    FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE,
    INDEX idx_article_id (article_id),
    INDEX idx_tag_id (tag_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ–‡ç« æ ‡ç­¾å…³è”è¡¨';
```

#### ğŸ’¬ äº’åŠ¨ç›¸å…³è¡¨

**commentsè¡¨ï¼ˆè¯„è®ºè¡¨ï¼‰**
```sql
CREATE TABLE comments (
    id CHAR(36) PRIMARY KEY COMMENT 'è¯„è®ºID',
    article_id CHAR(36) NOT NULL COMMENT 'æ–‡ç« ID',
    author_id CHAR(36) NOT NULL COMMENT 'è¯„è®ºè€…ID',
    parent_id CHAR(36) COMMENT 'çˆ¶è¯„è®ºID',
    content TEXT NOT NULL COMMENT 'è¯„è®ºå†…å®¹',
    status ENUM('published', 'pending', 'spam', 'deleted') DEFAULT 'published' COMMENT 'è¯„è®ºçŠ¶æ€',
    like_count INT UNSIGNED DEFAULT 0 COMMENT 'ç‚¹èµæ¬¡æ•°',
    reply_count INT UNSIGNED DEFAULT 0 COMMENT 'å›å¤æ¬¡æ•°',
    ip_address VARCHAR(45) COMMENT 'IPåœ°å€',
    user_agent TEXT COMMENT 'ç”¨æˆ·ä»£ç†',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    
    FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE,
    FOREIGN KEY (author_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (parent_id) REFERENCES comments(id) ON DELETE CASCADE,
    INDEX idx_article_id (article_id),
    INDEX idx_author_id (author_id),
    INDEX idx_parent_id (parent_id),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at DESC),
    INDEX idx_article_status_created (article_id, status, created_at DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è¯„è®ºè¡¨';
```

**likesè¡¨ï¼ˆç‚¹èµè¡¨ï¼‰**
```sql
CREATE TABLE likes (
    id CHAR(36) PRIMARY KEY COMMENT 'ç‚¹èµID',
    user_id CHAR(36) NOT NULL COMMENT 'ç”¨æˆ·ID',
    target_type ENUM('article', 'comment') NOT NULL COMMENT 'ç›®æ ‡ç±»å‹',
    target_id CHAR(36) NOT NULL COMMENT 'ç›®æ ‡ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    
    UNIQUE KEY uk_user_target (user_id, target_type, target_id),
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_target (target_type, target_id),
    INDEX idx_created_at (created_at DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç‚¹èµè¡¨';
```

**followsè¡¨ï¼ˆå…³æ³¨å…³ç³»è¡¨ï¼‰**
```sql
CREATE TABLE follows (
    id CHAR(36) PRIMARY KEY COMMENT 'å…³æ³¨ID',
    follower_id CHAR(36) NOT NULL COMMENT 'å…³æ³¨è€…ID',
    following_id CHAR(36) NOT NULL COMMENT 'è¢«å…³æ³¨è€…ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'å…³æ³¨æ—¶é—´',
    
    UNIQUE KEY uk_follow_relation (follower_id, following_id),
    FOREIGN KEY (follower_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (following_id) REFERENCES users(id) ON DELETE CASCADE,
    CHECK (follower_id != following_id),
    INDEX idx_follower_id (follower_id),
    INDEX idx_following_id (following_id),
    INDEX idx_created_at (created_at DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å…³æ³¨å…³ç³»è¡¨';
```

**bookmarksè¡¨ï¼ˆæ”¶è—è¡¨ï¼‰**
```sql
CREATE TABLE bookmarks (
    id CHAR(36) PRIMARY KEY COMMENT 'æ”¶è—ID',
    user_id CHAR(36) NOT NULL COMMENT 'ç”¨æˆ·ID',
    article_id CHAR(36) NOT NULL COMMENT 'æ–‡ç« ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'æ”¶è—æ—¶é—´',
    
    UNIQUE KEY uk_user_article (user_id, article_id),
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_article_id (article_id),
    INDEX idx_created_at (created_at DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ”¶è—è¡¨';
```

---

## 9.3.3 ç´¢å¼•ä¼˜åŒ–ç­–ç•¥

### ğŸ” ç´¢å¼•è®¾è®¡åŸåˆ™

#### ğŸ“Š ç´¢å¼•ç±»å‹é€‰æ‹©

**ä¸»é”®ç´¢å¼•ï¼ˆPRIMARY KEYï¼‰**
- **ç‰¹ç‚¹**ï¼šå”¯ä¸€ä¸”éç©ºï¼Œè‡ªåŠ¨åˆ›å»ºèšç°‡ç´¢å¼•
- **ä½¿ç”¨åœºæ™¯**ï¼šæ¯ä¸ªè¡¨çš„ä¸»é”®
- **ç¤ºä¾‹**ï¼š`id CHAR(36) PRIMARY KEY`

**å”¯ä¸€ç´¢å¼•ï¼ˆUNIQUEï¼‰**
- **ç‰¹ç‚¹**ï¼šä¿è¯å­—æ®µå€¼å”¯ä¸€æ€§
- **ä½¿ç”¨åœºæ™¯**ï¼šé‚®ç®±ã€ç”¨æˆ·åã€slugç­‰
- **ç¤ºä¾‹**ï¼š`UNIQUE KEY uk_email (email)`

**æ™®é€šç´¢å¼•ï¼ˆINDEXï¼‰**
- **ç‰¹ç‚¹**ï¼šæé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œå…è®¸é‡å¤å€¼
- **ä½¿ç”¨åœºæ™¯**ï¼šç»å¸¸ç”¨äºWHEREã€ORDER BYçš„å­—æ®µ
- **ç¤ºä¾‹**ï¼š`INDEX idx_created_at (created_at)`

**å¤åˆç´¢å¼•ï¼ˆComposite Indexï¼‰**
- **ç‰¹ç‚¹**ï¼šå¤šä¸ªå­—æ®µç»„åˆçš„ç´¢å¼•
- **ä½¿ç”¨åœºæ™¯**ï¼šå¤šå­—æ®µè”åˆæŸ¥è¯¢
- **ç¤ºä¾‹**ï¼š`INDEX idx_author_status (author_id, status)`

**å…¨æ–‡ç´¢å¼•ï¼ˆFULLTEXTï¼‰**
- **ç‰¹ç‚¹**ï¼šæ”¯æŒå…¨æ–‡æœç´¢
- **ä½¿ç”¨åœºæ™¯**ï¼šæ–‡ç« å†…å®¹æœç´¢
- **ç¤ºä¾‹**ï¼š`FULLTEXT INDEX idx_content_search (title, content)`

#### ğŸ¯ ç´¢å¼•è®¾è®¡ç­–ç•¥

**1. æŸ¥è¯¢é¢‘ç‡ä¼˜å…ˆ**
```sql
-- é«˜é¢‘æŸ¥è¯¢ï¼šæŒ‰ä½œè€…æŸ¥è¯¢å·²å‘å¸ƒæ–‡ç« 
SELECT * FROM articles 
WHERE author_id = ? AND status = 'published' 
ORDER BY published_at DESC;

-- å¯¹åº”ç´¢å¼•
INDEX idx_author_status_published (author_id, status, published_at DESC)
```

**2. é€‰æ‹©æ€§ä¼˜å…ˆ**
```sql
-- é«˜é€‰æ‹©æ€§å­—æ®µä¼˜å…ˆ
INDEX idx_email (email)           -- é€‰æ‹©æ€§é«˜
INDEX idx_status (status)         -- é€‰æ‹©æ€§ä½ï¼Œä½†æŸ¥è¯¢é¢‘ç¹
```

**3. æœ€å·¦å‰ç¼€åŸåˆ™**
```sql
-- å¤åˆç´¢å¼•ï¼š(author_id, status, published_at)
-- å¯ä»¥ä½¿ç”¨çš„æŸ¥è¯¢
WHERE author_id = ?                           -- âœ…
WHERE author_id = ? AND status = ?            -- âœ…
WHERE author_id = ? AND status = ? AND published_at > ?  -- âœ…

-- ä¸èƒ½ä½¿ç”¨çš„æŸ¥è¯¢
WHERE status = ?                              -- âŒ
WHERE published_at > ?                        -- âŒ
```

### ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–æŠ€å·§

#### ğŸš€ æŸ¥è¯¢ä¼˜åŒ–

**1. é¿å…SELECT ***
```sql
-- âŒ ä¸æ¨è
SELECT * FROM articles WHERE status = 'published';

-- âœ… æ¨è
SELECT id, title, summary, author_id, published_at 
FROM articles WHERE status = 'published';
```

**2. ä½¿ç”¨LIMITé™åˆ¶ç»“æœ**
```sql
-- âœ… åˆ†é¡µæŸ¥è¯¢
SELECT id, title, summary 
FROM articles 
WHERE status = 'published' 
ORDER BY published_at DESC 
LIMIT 20 OFFSET 0;
```

**3. åˆç†ä½¿ç”¨JOIN**
```sql
-- âœ… é«˜æ•ˆçš„JOINæŸ¥è¯¢
SELECT a.id, a.title, u.username, c.name as category_name
FROM articles a
INNER JOIN users u ON a.author_id = u.id
LEFT JOIN categories c ON a.category_id = c.id
WHERE a.status = 'published'
ORDER BY a.published_at DESC
LIMIT 20;
```

#### ğŸ“Š ç´¢å¼•ç›‘æ§

**1. æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ**
```sql
-- æŸ¥çœ‹è¡¨çš„ç´¢å¼•ä¿¡æ¯
SHOW INDEX FROM articles;

-- æŸ¥çœ‹ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯
SELECT 
    TABLE_NAME,
    INDEX_NAME,
    CARDINALITY,
    SUB_PART,
    NULLABLE
FROM INFORMATION_SCHEMA.STATISTICS 
WHERE TABLE_SCHEMA = 'blog_db' 
AND TABLE_NAME = 'articles';
```

**2. åˆ†ææŸ¥è¯¢æ‰§è¡Œè®¡åˆ’**
```sql
-- ä½¿ç”¨EXPLAINåˆ†ææŸ¥è¯¢
EXPLAIN SELECT * FROM articles 
WHERE author_id = 'uuid' AND status = 'published' 
ORDER BY published_at DESC;

-- è¯¦ç»†åˆ†æ
EXPLAIN FORMAT=JSON SELECT * FROM articles 
WHERE author_id = 'uuid' AND status = 'published';
```

---

## 9.3.4 æ•°æ®è¿ç§»ä¸ç‰ˆæœ¬ç®¡ç†

### ğŸ”„ æ•°æ®åº“è¿ç§»ç­–ç•¥

#### ğŸ“‹ è¿ç§»æ–‡ä»¶ç»„ç»‡

**è¿ç§»æ–‡ä»¶å‘½åè§„èŒƒ**ï¼š
```
migrations/
â”œâ”€â”€ 001_create_users_table.sql
â”œâ”€â”€ 002_create_user_profiles_table.sql
â”œâ”€â”€ 003_create_categories_table.sql
â”œâ”€â”€ 004_create_articles_table.sql
â”œâ”€â”€ 005_create_tags_table.sql
â”œâ”€â”€ 006_create_article_tags_table.sql
â”œâ”€â”€ 007_create_comments_table.sql
â”œâ”€â”€ 008_add_indexes_to_articles.sql
â”œâ”€â”€ 009_add_fulltext_search_index.sql
â””â”€â”€ 010_add_user_roles_system.sql
```

**è¿ç§»æ–‡ä»¶ç»“æ„**ï¼š
```sql
-- 001_create_users_table.sql
-- Migration: Create users table
-- Created: 2024-01-01 10:00:00
-- Author: Developer Name

-- Up Migration
CREATE TABLE users (
    id CHAR(36) PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    status ENUM('active', 'inactive', 'banned') DEFAULT 'active',
    email_verified BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_email (email),
    INDEX idx_username (username),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Down Migration (Rollback)
DROP TABLE IF EXISTS users;
```

#### ğŸ› ï¸ TypeORMè¿ç§»é…ç½®

**æ•°æ®æºé…ç½®**ï¼š
```typescript
// src/config/database.config.ts
import { DataSource } from 'typeorm';

export const AppDataSource = new DataSource({
  type: 'mysql',
  host: process.env.DB_HOST || 'localhost',
  port: parseInt(process.env.DB_PORT) || 3306,
  username: process.env.DB_USERNAME || 'root',
  password: process.env.DB_PASSWORD || '',
  database: process.env.DB_DATABASE || 'blog_db',
  charset: 'utf8mb4',
  timezone: '+00:00',
  synchronize: false, // ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¸ºfalse
  logging: process.env.NODE_ENV === 'development',
  entities: ['src/**/*.entity.ts'],
  migrations: ['src/migrations/*.ts'],
  migrationsTableName: 'migrations',
});
```

**è¿ç§»å‘½ä»¤**ï¼š
```bash
# ç”Ÿæˆè¿ç§»æ–‡ä»¶
npm run typeorm migration:generate -- src/migrations/CreateUsersTable

# è¿è¡Œè¿ç§»
npm run typeorm migration:run

# å›æ»šè¿ç§»
npm run typeorm migration:revert

# æŸ¥çœ‹è¿ç§»çŠ¶æ€
npm run typeorm migration:show
```

### ğŸ“Š æ•°æ®åˆå§‹åŒ–

#### ğŸŒ± ç§å­æ•°æ®è®¾è®¡

**åŸºç¡€æ•°æ®åˆå§‹åŒ–**ï¼š
```sql
-- seeds/001_basic_roles.sql
INSERT INTO roles (id, name, description, permissions) VALUES
('admin-role-uuid', 'admin', 'ç³»ç»Ÿç®¡ç†å‘˜', '["*"]'),
('editor-role-uuid', 'editor', 'ç¼–è¾‘', '["article:*", "comment:moderate"]'),
('author-role-uuid', 'author', 'ä½œè€…', '["article:create", "article:edit:own"]'),
('reader-role-uuid', 'reader', 'è¯»è€…', '["article:read", "comment:create"]');

-- seeds/002_default_categories.sql
INSERT INTO categories (id, name, slug, description) VALUES
('tech-category-uuid', 'æŠ€æœ¯', 'technology', 'æŠ€æœ¯ç›¸å…³æ–‡ç« '),
('life-category-uuid', 'ç”Ÿæ´»', 'lifestyle', 'ç”Ÿæ´»åˆ†äº«æ–‡ç« '),
('tutorial-category-uuid', 'æ•™ç¨‹', 'tutorial', 'æ•™ç¨‹ç±»æ–‡ç« ');

-- seeds/003_default_tags.sql
INSERT INTO tags (id, name, slug, description, color) VALUES
('javascript-tag-uuid', 'JavaScript', 'javascript', 'JavaScriptç›¸å…³', '#f7df1e'),
('typescript-tag-uuid', 'TypeScript', 'typescript', 'TypeScriptç›¸å…³', '#3178c6'),
('nodejs-tag-uuid', 'Node.js', 'nodejs', 'Node.jsç›¸å…³', '#339933'),
('mysql-tag-uuid', 'MySQL', 'mysql', 'MySQLæ•°æ®åº“', '#4479a1');
```

#### ğŸ”§ æ•°æ®åº“ç»´æŠ¤

**å®šæœŸç»´æŠ¤ä»»åŠ¡**ï¼š
```sql
-- 1. æ›´æ–°ç»Ÿè®¡è®¡æ•°
UPDATE categories c SET article_count = (
    SELECT COUNT(*) FROM articles a 
    WHERE a.category_id = c.id AND a.status = 'published'
);

UPDATE tags t SET usage_count = (
    SELECT COUNT(*) FROM article_tags at 
    WHERE at.tag_id = t.id
);

-- 2. æ¸…ç†è½¯åˆ é™¤æ•°æ®
DELETE FROM articles 
WHERE status = 'deleted' 
AND updated_at < DATE_SUB(NOW(), INTERVAL 30 DAY);

-- 3. ä¼˜åŒ–è¡¨ç»“æ„
OPTIMIZE TABLE articles;
OPTIMIZE TABLE comments;
ANALYZE TABLE articles;
ANALYZE TABLE comments;
```

---

## ğŸ“Š æœ¬èŠ‚æ€»ç»“

### ğŸ¯ å…³é”®è¦ç‚¹å›é¡¾

1. **æ•°æ®åº“è®¾è®¡è¦éµå¾ªè§„èŒƒ**
   - åˆç†çš„å‘½åè§„èŒƒå’Œæ•°æ®ç±»å‹é€‰æ‹©
   - å®Œæ•´çš„çº¦æŸå’Œå…³ç³»è®¾è®¡
   - è€ƒè™‘æ€§èƒ½å’Œæ‰©å±•æ€§

2. **å®ä½“å…³ç³»å»ºæ¨¡è¦å‡†ç¡®**
   - æ­£ç¡®è¯†åˆ«å®ä½“å’Œå…³ç³»
   - åˆç†è®¾è®¡è¡¨ç»“æ„
   - é¿å…æ•°æ®å†—ä½™å’Œä¸ä¸€è‡´

3. **ç´¢å¼•è®¾è®¡è¦ç§‘å­¦**
   - åŸºäºæŸ¥è¯¢æ¨¡å¼è®¾è®¡ç´¢å¼•
   - å¹³è¡¡æŸ¥è¯¢æ€§èƒ½å’Œå­˜å‚¨ç©ºé—´
   - å®šæœŸç›‘æ§å’Œä¼˜åŒ–

4. **æ•°æ®è¿ç§»è¦è§„èŒƒ**
   - ç‰ˆæœ¬åŒ–ç®¡ç†æ•°æ®åº“å˜æ›´
   - å¯å›æ»šçš„è¿ç§»ç­–ç•¥
   - å®Œæ•´çš„æ•°æ®åˆå§‹åŒ–

### ğŸ“ å®è·µç»ƒä¹ 

#### ç»ƒä¹ 1ï¼šå®Œæ•´è¡¨ç»“æ„è®¾è®¡
**ä»»åŠ¡**ï¼šè®¾è®¡åšå®¢ç³»ç»Ÿçš„å®Œæ•´æ•°æ®åº“è¡¨ç»“æ„
**è¦æ±‚**ï¼š
- åŒ…å«æ‰€æœ‰æ ¸å¿ƒä¸šåŠ¡è¡¨
- è®¾è®¡åˆç†çš„å­—æ®µç±»å‹å’Œçº¦æŸ
- æ·»åŠ å¿…è¦çš„ç´¢å¼•

#### ç»ƒä¹ 2ï¼šERå›¾ç»˜åˆ¶
**ä»»åŠ¡**ï¼šç»˜åˆ¶åšå®¢ç³»ç»Ÿçš„å®Œæ•´ERå›¾
**è¦æ±‚**ï¼š
- æ ‡æ˜æ‰€æœ‰å®ä½“å’Œå…³ç³»
- åŒ…å«å­—æ®µç±»å‹å’Œçº¦æŸ
- ä½“ç°ä¸šåŠ¡é€»è¾‘

#### ç»ƒä¹ 3ï¼šæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ
**ä»»åŠ¡**ï¼šåˆ¶å®šæ•°æ®åº“æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ
**è¦æ±‚**ï¼š
- åˆ†ææŸ¥è¯¢æ¨¡å¼
- è®¾è®¡ç´¢å¼•ç­–ç•¥
- åˆ¶å®šç›‘æ§æ–¹æ¡ˆ

### ğŸ” è‡ªæˆ‘æ£€æµ‹

- [ ] æˆ‘èƒ½å¤Ÿè®¾è®¡è§„èŒƒçš„æ•°æ®åº“è¡¨ç»“æ„
- [ ] æˆ‘ç†è§£å®ä½“å…³ç³»å»ºæ¨¡çš„æ–¹æ³•
- [ ] æˆ‘æŒæ¡äº†ç´¢å¼•è®¾è®¡çš„åŸåˆ™
- [ ] æˆ‘èƒ½å¤Ÿåˆ¶å®šæ•°æ®è¿ç§»æ–¹æ¡ˆ
- [ ] æˆ‘äº†è§£æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–æŠ€å·§

### ğŸ¯ ä¸‹ä¸€æ­¥å­¦ä¹ 

å®Œæˆæœ¬èŠ‚å­¦ä¹ åï¼Œä½ å·²ç»æŒæ¡äº†ï¼š
- âœ… MySQLæ•°æ®åº“è®¾è®¡è§„èŒƒå’ŒåŸåˆ™
- âœ… å®ä½“å…³ç³»å»ºæ¨¡å’Œè¡¨ç»“æ„è®¾è®¡
- âœ… ç´¢å¼•ä¼˜åŒ–ç­–ç•¥å’Œæ€§èƒ½è°ƒä¼˜
- âœ… æ•°æ®è¿ç§»å’Œç‰ˆæœ¬ç®¡ç†æ–¹æ³•

**å‡†å¤‡å¥½è¿›å…¥ç¬¬9.4èŠ‚äº†å—ï¼Ÿ** ğŸš€

åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å¼€å§‹æ­å»ºå¼€å‘ç¯å¢ƒï¼ŒåŒ…æ‹¬ï¼š
- ğŸ› ï¸ é¡¹ç›®è„šæ‰‹æ¶åˆ›å»º
- ğŸ”§ å¼€å‘å·¥å…·é…ç½®
- ï¿½ï¿½ ä»£ç è§„èŒƒè®¾ç½®
- ğŸ› è°ƒè¯•ç¯å¢ƒé…ç½® 