# 数据流向图

## 用户注册流程

```
+-------------+     +------------------+     +---------------+     +--------------+
| HTTP 请求    | --> | UserController   | --> | UserService   | --> | TypeORM      |
| POST /users |     | register()       |     | register()    |     | Repository   |
+-------------+     +------------------+     +---------------+     +--------------+
                            |                        |                    |
                            v                        v                    v
                    +----------------+      +----------------+    +---------------+
                    | 验证请求数据    |      | 创建用户实体    |    | 数据库         |
                    | (RegisterDto)  |      | (User)         |    | (MySQL)       |
                    +----------------+      +----------------+    +---------------+
```

详细流程步骤：

1. 客户端发送 HTTP POST 请求到 `/users/register` 端点，包含用户注册信息
2. UserController 的 register 方法接收请求，使用 RegisterDto 验证请求数据
3. 验证通过后，控制器调用 UserService 的 register 方法
4. UserService 创建一个新的 User 实体对象，填充注册信息
5. UserService 使用 UserRepository (由 TypeORM 提供) 将用户实体保存到数据库
6. 数据库执行 INSERT 操作，保存用户记录
7. 操作结果返回给 UserService，再返回给 UserController
8. UserController 将操作结果作为 HTTP 响应返回给客户端

## 数据持久化流程

```
+---------------+     +---------------+     +---------------+
| 业务逻辑层    | --> | TypeORM 实体   | --> | 数据库        |
| (Service)     |     | (Entity)      |     | (MySQL)      |
+---------------+     +---------------+     +---------------+
        ^                     ^                    ^
        |                     |                    |
+---------------+     +---------------+     +---------------+
| 控制器        |     | 实体仓库       |     | 表结构        |
| (Controller)  |     | (Repository)   |     | (Tables)     |
+---------------+     +---------------+     +---------------+
```

数据持久化主要通过 TypeORM 实现：

1. 实体类 (例如 User) 通过装饰器 (@Entity, @Column 等) 定义表结构和字段属性
2. TypeORM 自动将实体类映射到数据库表
3. 服务层通过依赖注入获取实体仓库 (Repository)
4. 服务层使用仓库接口进行 CRUD 操作
5. TypeORM 将操作转换为 SQL 语句并执行

## 请求处理流程

```
+-------------+     +------------------+     +---------------+     +--------------+
| 客户端      | --> | 控制器           | --> | 服务层        | --> | 数据访问层   |
| (Client)    |     | (Controller)     |     | (Service)     |     | (Repository) |
+-------------+     +------------------+     +---------------+     +--------------+
        ^                    ^                      ^                     ^
        |                    |                      |                     |
        |                    v                      v                     v
        |             +--------------+      +---------------+     +---------------+
        +-------------|  HTTP 响应   |<-----| 业务逻辑处理  |<----| 数据库操作    |
                     | (Response)   |      | (Logic)       |     | (Database)    |
                     +--------------+      +---------------+     +---------------+
```

NestJS 处理请求的标准流程：

1. 客户端发送 HTTP 请求到特定端点
2. NestJS 路由将请求导向对应的控制器方法
3. 控制器方法接收请求，提取并验证数据
4. 控制器调用服务层执行业务逻辑
5. 服务层通过数据访问层 (Repository) 与数据库交互
6. 服务层处理业务逻辑，返回结果给控制器
7. 控制器将结果格式化为 HTTP 响应
8. 响应返回给客户端 