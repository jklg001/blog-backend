# 代码规范和约定

## 整体架构约定

1. **模块化设计**: 系统按功能划分为独立模块，每个模块包含自己的控制器、服务、DTO和实体
2. **依赖注入**: 使用NestJS的依赖注入系统，遵循控制反转原则
3. **分层架构**: 遵循控制器->服务->数据访问层的分层设计
4. **环境配置**: 使用环境变量和ConfigModule进行配置管理

## 命名约定

1. **文件命名**:
   - 模块文件: `feature.module.ts`
   - 控制器文件: `feature.controller.ts`
   - 服务文件: `feature.service.ts`
   - 实体文件: `feature.entity.ts`
   - DTO文件: `action.dto.ts` (如 `register.dto.ts`)

2. **类命名**:
   - 模块类: `FeatureModule`
   - 控制器类: `FeatureController`
   - 服务类: `FeatureService`
   - 实体类: 单数形式, 如 `User`
   - DTO类: `ActionDto`, 如 `RegisterDto`

3. **变量命名**:
   - 遵循驼峰命名法 (camelCase)
   - 私有成员变量使用下划线前缀 (如 `_privateVar`)

## 代码格式

1. **代码格式化**: 使用 Prettier 进行代码格式化
2. **代码检查**: 使用 ESLint 进行代码规范检查
3. **空格和缩进**: 使用2个空格进行缩进
4. **最大行长**: 建议每行不超过100个字符

## TypeScript 规范

1. **严格类型**: 尽量避免使用 `any` 类型
2. **接口优先**: 先定义接口，再实现类
3. **可选属性**: 使用 `?` 表示可选属性，如 `property?: string`
4. **类型导出**: 导出所有公共类型和接口

## API 设计约定

1. **RESTful 规范**:
   - 使用适当的HTTP方法 (GET, POST, PUT, DELETE)
   - 资源使用复数名词 (如 `/users`, `/articles`)
   - 子资源使用嵌套路径 (如 `/articles/{id}/comments`)

2. **请求验证**:
   - 使用 class-validator 装饰器进行请求验证
   - 为所有DTO属性添加适当的验证规则

3. **响应格式**:
   - 成功响应直接返回数据
   - 错误响应使用NestJS异常过滤器处理

## 数据库约定

1. **命名规则**:
   - 表名: 使用复数形式和下划线命名法 (如 `blog_user_accounts`)
   - 列名: 使用驼峰命名法
   - 主键: 使用 `id` 
   - 外键: 使用 `entityName+Id` 格式 (如 `userId`)

2. **字段约定**:
   - 包含创建和更新时间戳 (`createdAt`, `updatedAt`)
   - 使用软删除机制 (`deletedAt` 或 `isDeleted`)
   - 为可能搜索的字段添加索引

## 安全约定

1. **密码处理**:
   - 使用 bcrypt 进行密码加密
   - 不直接存储明文密码

2. **用户认证**:
   - 使用 JWT 进行认证
   - 实现令牌刷新机制
   - 设置适当的令牌过期时间

3. **输入验证**:
   - 对所有用户输入进行验证
   - 防止SQL注入和XSS攻击

## 错误处理

1. **异常类型**:
   - 使用NestJS内置异常类
   - 根据需要创建自定义异常类

2. **日志记录**:
   - 记录所有错误和异常
   - 包含足够的上下文信息

## 测试约定

1. **单元测试**:
   - 为所有服务和控制器编写单元测试
   - 使用模拟对象隔离依赖

2. **端到端测试**:
   - 为关键API路径编写端到端测试
   - 使用测试数据库而非生产数据库 